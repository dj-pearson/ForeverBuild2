-- test_fix_inventory_placement.luau
-- Quick fix for inventory item placement

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local player = Players.LocalPlayer

print("=== FIXING INVENTORY PLACEMENT ===")

-- Wait for shared module
task.wait(2) -- Give system time to initialize

local shared = ReplicatedStorage:FindFirstChild("shared")
if not shared then
    warn("‚ùå Shared module not found")
    return
end

local SharedModule = require(shared)
if not SharedModule then
    warn("‚ùå SharedModule not loaded")
    return
end

print("‚úÖ SharedModule loaded")

-- Check if InventoryUI exists
if not SharedModule.InventoryUI then
    warn("‚ùå InventoryUI not found in SharedModule")
    return
end

print("‚úÖ InventoryUI found")

-- Check if PlacementManagerClientInstance exists
if not SharedModule.PlacementManagerClientInstance then
    warn("‚ùå PlacementManagerClientInstance not found")
    return
end

print("‚úÖ PlacementManagerClientInstance found")

-- Set up the OnItemSelected callback directly
SharedModule.InventoryUI.OnItemSelected = function(itemName, itemData)
    print("üîÑ Inventory item selected:", itemName)
    
    -- Normalize the item name
    local normalizedItemName = itemName:gsub(" ", "_")
    
    -- Try ShowItemInHand first
    if SharedModule.PlacementManagerClientInstance.ShowItemInHand then
        print("üéØ Using ShowItemInHand method")
        local success = SharedModule.PlacementManagerClientInstance:ShowItemInHand(normalizedItemName)
        if success then
            print("‚úÖ Item shown in hand successfully")
        else
            warn("‚ùå ShowItemInHand failed")
        end
    -- Fallback to RecallItemFromInventory
    elseif SharedModule.PlacementManagerClientInstance.RecallItemFromInventory then
        print("üéØ Using RecallItemFromInventory method")
        local success = SharedModule.PlacementManagerClientInstance:RecallItemFromInventory(normalizedItemName)
        if success then
            print("‚úÖ Item recalled successfully")
        else
            warn("‚ùå RecallItemFromInventory failed")
        end
    else
        warn("‚ùå No placement method available")
        print("Available methods in PlacementManagerClientInstance:")
        for k, v in pairs(SharedModule.PlacementManagerClientInstance) do
            if type(v) == "function" then
                print("  -", k)
            end
        end
    end
end

print("‚úÖ OnItemSelected callback has been set up!")
print("üéâ Try clicking on an inventory item now - it should work!") 