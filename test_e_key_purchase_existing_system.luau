-- test_e_key_purchase_existing_system.luau
-- Test script for the enhanced E-key purchase functionality using existing system

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer

print("ğŸ§ª Testing Existing E-Key Purchase System...")

-- Wait for the system to initialize
wait(3)

-- Check if ItemInteractionClient exists and has the correct methods
local function testExistingEKeySystem()
    print("âœ“ Checking for existing ItemInteractionClient system...")
    
    -- Look for the ItemInteractionClient which should have the enhanced store item interaction
    if _G.ItemInteractionClient then
        local client = _G.ItemInteractionClient
        
        print("âœ“ Found ItemInteractionClient")
        
        -- Check if the new methods exist
        if client.InteractWithStoreItem and client.GetStoreItemPrice and client.PurchaseStoreItem then
            print("âœ“ Enhanced store item methods found")
            
            -- Check if the client has proper initialization
            if client.isInteracting ~= nil and client.currentTarget ~= nil then
                print("âœ“ Client state variables initialized")
                
                -- Simulate getting a store item price
                local testPrice = client:GetStoreItemPrice({
                    Name = "Basic_Red_Brick_Wall",
                    GetAttribute = function(self, attr)
                        if attr == "priceIngame" then return 100 end
                        return nil
                    end
                })
                print("âœ“ GetStoreItemPrice test returned:", testPrice)
                
                -- Test getting player coins
                local coins = client:GetPlayerCoins()
                print("âœ“ GetPlayerCoins test returned:", coins)
                
                print("ğŸ‰ Enhanced E-Key Purchase System Ready!")
                print("ğŸ“ Instructions:")
                print("  1. Walk close to any store item (like the Red Brick Wall)")
                print("  2. Point your mouse at the item")
                print("  3. Press E to purchase with coins")
                print("  4. If you don't have enough coins, you'll see a notification")
                print("  5. The purchase will be processed immediately!")
                
                return true
            else
                print("âŒ Client state variables not properly initialized")
                return false
            end
        else
            print("âŒ Enhanced store item methods not found")
            return false
        end
    else
        print("âŒ ItemInteractionClient not found in _G")
        return false
    end
end

-- Test the Enhanced E-Key Purchase System
local success = testExistingEKeySystem()

if success then
    print("âœ… Enhanced E-Key Purchase System Test PASSED")
    
    -- Set up a demonstration by showing current status
    spawn(function()
        while true do
            if _G.ItemInteractionClient and _G.ItemInteractionClient.currentTarget then
                local target = _G.ItemInteractionClient.currentTarget
                if _G.ItemInteractionClient:IsStoreItem(target) then
                    local itemName = target.Name:gsub("_", " ")
                    local price = _G.ItemInteractionClient:GetStoreItemPrice(target)
                    local coins = _G.ItemInteractionClient:GetPlayerCoins()
                    
                    print("ğŸ¯ Currently targeting store item:", itemName)
                    print("ğŸ’° Price:", price, "coins | You have:", coins, "coins")
                    
                    if coins >= price then
                        print("âœ… Press E to purchase with coins!")
                    else
                        print("âŒ Need", (price - coins), "more coins to purchase")
                    end
                end
            end
            wait(2)
        end
    end)
else
    print("âŒ Enhanced E-Key Purchase System Test FAILED")
    print("ğŸ’¡ Make sure the enhanced ItemInteractionClient is loaded properly")
end

print("ğŸ”§ Test script complete - Enhanced E-Key Purchase System ready to use!") 