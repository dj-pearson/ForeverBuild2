-- Test script for the new clear placement controls system
print("=== PLACEMENT CONTROLS SYSTEM TEST ===")

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")

-- Wait for player
local player = Players.LocalPlayer
if not player then
    print("âŒ No LocalPlayer found - test only works in game")
    return
end

print("âœ… Player found:", player.Name)

-- Test 1: Check if PlacementControlsUI is available
print("\nğŸ” TEST 1: Checking PlacementControlsUI")

local PlacementControlsUI
local success, err = pcall(function()
    PlacementControlsUI = require(ReplicatedStorage:WaitForChild("shared"):WaitForChild("core"):WaitForChild("placement"):WaitForChild("PlacementControlsUI"))
end)

if success and PlacementControlsUI then
    print("âœ… PlacementControlsUI module loaded successfully")
    
    -- Test creating an instance
    local controlsUI = PlacementControlsUI.new()
    if controlsUI then
        print("âœ… PlacementControlsUI instance created successfully")
        print("   - Is active:", controlsUI:IsActive())
    else
        print("âŒ Failed to create PlacementControlsUI instance")
    end
else
    print("âŒ Failed to load PlacementControlsUI:", err)
    return
end

-- Test 2: Check PlacementManager integration
print("\nğŸ” TEST 2: Checking PlacementManager Integration")

local SharedModule
local success2, err2 = pcall(function()
    SharedModule = require(ReplicatedStorage:WaitForChild("shared"):WaitForChild("inits"))
end)

if success2 and SharedModule then
    print("âœ… SharedModule loaded")
    
    local PlacementManager = SharedModule.PlacementManagerClientInstance or SharedModule.PlacementManager
    if PlacementManager then
        print("âœ… PlacementManager found")
        
        -- Check if placement controls UI is initialized
        if PlacementManager.placementControlsUI then
            print("âœ… PlacementManager has PlacementControlsUI")
        else
            print("âŒ PlacementManager missing PlacementControlsUI")
        end
        
        -- Check if rotation UI is still available
        if PlacementManager.simpleRotationUI then
            print("âœ… PlacementManager has SimpleRotationUI")
        else
            print("âŒ PlacementManager missing SimpleRotationUI")
        end
    else
        print("âŒ PlacementManager not found in SharedModule")
    end
else
    print("âŒ Failed to load SharedModule:", err2)
end

-- Test 3: Demo the placement controls interface
print("\nğŸ” TEST 3: Creating Demo Placement Controls")

if PlacementControlsUI and RunService:IsClient() then
    local demoControlsUI = PlacementControlsUI.new()
    
    -- Demo callbacks
    local onRotate = function()
        print("ğŸ”„ Demo: Rotate button activated!")
        demoControlsUI:PulseControl(2) -- Pulse the rotate control
    end
    
    local onPlace = function()
        print("âœ… Demo: Place button activated!")
        demoControlsUI:PulseControl(1) -- Pulse the place control
    end
    
    local onCancel = function()
        print("âŒ Demo: Cancel button activated!")
        demoControlsUI:Hide()
    end
    
    -- Show demo after a delay
    task.spawn(function()
        task.wait(2)
        print("\nğŸ® DEMO: Showing PlacementControlsUI in 3 seconds...")
        task.wait(3)
        
        print("ğŸ“‹ DEMO: Placement controls activated!")
        print("   Try the following:")
        print("   ğŸ“± Mobile: Tap the controls in the UI")
        print("   ğŸ–¥ï¸  PC: Use SPACE for rotate, CLICK for place, RIGHT-CLICK for cancel")
        print("   ğŸ® Console: Use Y for rotate, A for place, B for cancel")
        
        demoControlsUI:Show("Demo_Cube", onRotate, onPlace, onCancel)
        
        -- Auto-demo some features
        task.wait(2)
        print("ğŸ”„ Demo: Auto-rotating...")
        onRotate()
        
        task.wait(2)
        print("ğŸ“ Demo: Auto-placing...")
        onPlace()
    end)
    
    -- Clean up after demo
    task.spawn(function()
        task.wait(20) -- Wait 20 seconds then clean up
        if demoControlsUI and demoControlsUI:IsActive() then
            demoControlsUI:Hide()
            print("ğŸ§¹ Cleaned up demo controls UI")
        end
    end)
    
else
    print("âš ï¸  Demo controls creation skipped (missing PlacementControlsUI or not client)")
end

-- Test 4: Instructions for real testing
print("\nğŸ® REAL TESTING INSTRUCTIONS:")
print("To test the new clear controls system:")
print("")
print("1. ğŸ“¦ Select an item from your inventory")
print("2. ğŸ‘€ Look for the controls panel in the BOTTOM LEFT corner")
print("3. ğŸ® The panel shows three clear options:")
print("   ğŸ–±ï¸  LEFT CLICK (or A button): Place Item")
print("   ğŸ”„ SPACE (or Y button): Rotate Item")  
print("   ğŸ“¦ RIGHT CLICK (or B button): Return to Inventory")
print("")
print("4. ğŸ”„ Try clicking the rotate button (or press SPACE)")
print("5. ğŸ›ï¸  The rotation UI will appear with clear controls")
print("6. âœ… Confirm rotation or âŒ cancel to return to placement")
print("7. ğŸ–±ï¸  Left-click to place the item where you want")
print("8. ğŸ“¦ Right-click anytime to return item to inventory")

print("\nğŸ¯ NEW FEATURES:")
print("â€¢ ğŸ“‹ Clear visual instructions in bottom left")
print("â€¢ ğŸ® Platform-aware controls (shows correct buttons)")
print("â€¢ ğŸ”„ SPACE key for rotation (instead of R)")
print("â€¢ ğŸ“¦ RIGHT-CLICK preserved for returning to inventory")
print("â€¢ ğŸ–±ï¸  Clickable controls for touch/mobile users")
print("â€¢ ğŸ® Console controller support")

print("\nâœ… PLACEMENT CONTROLS SYSTEM TEST COMPLETED")
print("")
print("ğŸ‰ The system now clearly shows:")
print("   â€¢ What item you're placing")
print("   â€¢ What controls are available")
print("   â€¢ How to use them on your platform")
print("   â€¢ Visual feedback when you use them")
print("")
print("No more confusion about controls! ğŸš€") 